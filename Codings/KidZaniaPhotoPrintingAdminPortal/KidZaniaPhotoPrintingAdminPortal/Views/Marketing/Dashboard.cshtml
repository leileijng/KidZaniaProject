@{
    Layout = "~/Views/Shared/Menu.cshtml";
}
<!-- slimscroll js-->
<script src="~/assets/vendor/slimscroll/jquery.slimscroll.js"></script>
<!-- chartjs js-->
<script src="~/assets/vendor/charts/charts-bundle/Chart.bundle.js"></script>
<script src="~/assets/vendor/charts/charts-bundle/chartjs.js"></script>

<!-- main js-->
<script src="~/assets/libs/js/main-js.js"></script>
<!-- jvactormap js-->
<script src="~/assets/vendor/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
<script src="~/assets/vendor/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<!-- sparkline js-->
<script src="~/assets/vendor/charts/sparkline/jquery.sparkline.js"></script>
<script src="~/assets/vendor/charts/sparkline/spark-js.js"></script>
<!-- dashboard sales js-->
<script src="~/assets/libs/js/dashboard-sales.js"></script>

<div class="container-fluid  dashboard-content">
    <!-- ============================================================== -->
    <!-- pagehader  -->
    <!-- ============================================================== -->
    <div class="row">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <div class="page-header">
                <h3 class="mb-2">Sales Dashboard </h3>
            </div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- pagehader  -->
    <!-- ============================================================== -->
    <div class="row">
        <!-- metric -->
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="text-muted">Order</h5>
                    <div class="metric-value d-inline-block">
                        <h1 class="mb-1 text-primary" id="NumberOfOrder">32,100 </h1>
                    </div>
                    <div class="metric-label d-inline-block float-right text-success" id="ColorOfOrder">
                        <i class="fa fa-fw fa-caret-up" id="IconOfOrder"></i><span id="RateOfOrder">5.27%</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- /. metric -->
        <!-- metric -->
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="text-muted">Revenue</h5>
                    <div class="metric-value d-inline-block">
                        <h1 class="mb-1 text-primary" id="numberOfRevenue">$5,656</h1>
                    </div>
                    <div class="metric-label d-inline-block float-right text-danger" id="ColorOfRevenue">
                        <i class="fa fa-fw fa-caret-down" id="IconOfRevenue"></i><span id="RateOfRevenue">1.08%</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- /. metric -->
        <!-- metric -->
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="text-muted">Printed Photos</h5>
                    <div class="metric-value d-inline-block">
                        <h1 class="mb-1 text-primary" id="numberOfPhotos">22</h1>
                    </div>
                    <div class="metric-label d-inline-block float-right text-success" id="ColorOfPhotos">
                        <i class="fa fa-fw fa-caret-up" id="IconOfPhotos"></i><span id="rateOfPhotos">4.87%</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- /. metric -->
        <!-- metric -->
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="text-muted" id="numberOfPO">Waiting Orders</h5>
                    <div class="metric-value d-inline-block">
                        <h1 class="mb-1 text-primary">12</h1>
                    </div>
                </div>
            </div>
        </div>
        <!-- /. metric -->
    </div>
    <!-- ============================================================== -->
    <!-- revenue  -->
    <!-- ============================================================== -->
    <div class="row">
        <div class="col-xl-8 col-lg-12 col-md-8 col-sm-12 col-12">
            <div class="card">
                <h5 class="card-header">Revenue</h5>
                <div class="card-body">
                    <div id="lineChart"></div>
                </div>
                <div class="card-body border-top">
                    <div class="row">
                        <div class="offset-xl-1 col-xl-3 col-lg-3 col-md-12 col-sm-12 col-12 p-3">
                            <h4> Today's Earning: $2,800.30</h4>
                            <p>
                                Suspendisse potenti. Done csit amet rutrum.
                            </p>
                        </div>
                        <div class="offset-xl-1 col-xl-3 col-lg-3 col-md-6 col-sm-12 col-12 p-3">
                            <h2 class="font-weight-normal mb-3"><span>$48,325</span></h2>
                            <div class="mb-0 mt-3 legend-item">
                                <span class="fa-xs text-primary mr-1 legend-title "><i class="fa fa-fw fa-square-full"></i></span>
                                <span class="legend-text">Current Week</span>
                            </div>
                        </div>
                        <div class="offset-xl-1 col-xl-3 col-lg-3 col-md-6 col-sm-12 col-12 p-3">
                            <h2 class="font-weight-normal mb-3">
                                <span>$59,567</span>
                            </h2>
                            <div class="text-muted mb-0 mt-3 legend-item"> <span class="fa-xs text-secondary mr-1 legend-title"><i class="fa fa-fw fa-square-full"></i></span><span class="legend-text">Previous Week</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- end reveune  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- total sale  -->
        <!-- ============================================================== -->
        <div class="col-xl-4 col-lg-12 col-md-4 col-sm-12 col-12">
            <div class="card">
                <h5 class="card-header">Total Sales</h5>
                <div class="card-body">
                    <div id="donutchartForProductSales"></div>
                    <div class="chart-widget-list" id="productLegend">

                    </div>
                </div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- end total sale  -->
        <!-- ============================================================== -->
    </div>
    <div class="row">
        <!-- ============================================================== -->
        <!-- top selling products  -->
        <!-- ============================================================== -->
        <div class="col-xl-7 col-lg-12 col-md-12 col-sm-12 col-12">
            <div class="card">
                <h5 class="card-header">Top Selling Products</h5>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="bg-light">
                                <tr class="border-0">
                                    <th class="border-0">#</th>
                                    <th class="border-0">Image</th>
                                    <th class="border-0">Product Name</th>
                                    <th class="border-0">Product Id</th>
                                    <th class="border-0">Quantity</th>
                                    <th class="border-0">Price</th>
                                    <th class="border-0">Order Time</th>
                                    <th class="border-0">Customer</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>
                                        <div class="m-r-10"><img src="~/assets/images/product-pic.jpg" alt="user" class="rounded" width="45"></div>
                                    </td>
                                    <td>Product #1 </td>
                                    <td>id000001 </td>
                                    <td>20</td>
                                    <td>$80.00</td>
                                    <td>27-08-2018 01:22:12</td>
                                    <td>Patricia J. King </td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>
                                        <div class="m-r-10"><img src="~/assets/images/product-pic-2.jpg" alt="user" class="rounded" width="45"></div>
                                    </td>
                                    <td>Product #2 </td>
                                    <td>id000002 </td>
                                    <td>12</td>
                                    <td>$180.00</td>
                                    <td>25-08-2018 21:12:56</td>
                                    <td>Rachel J. Wicker </td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>
                                        <div class="m-r-10"><img src="~/assets/images/product-pic-3.jpg" alt="user" class="rounded" width="45"></div>
                                    </td>
                                    <td>Product #3 </td>
                                    <td>id000003 </td>
                                    <td>23</td>
                                    <td>$820.00</td>
                                    <td>24-08-2018 14:12:77</td>
                                    <td>Michael K. Ledford </td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>
                                        <div class="m-r-10"><img src="~/assets/images/product-pic-4.jpg" alt="user" class="rounded" width="45"></div>
                                    </td>
                                    <td>Product #4 </td>
                                    <td>id000004 </td>
                                    <td>34</td>
                                    <td>$340.00</td>
                                    <td>23-08-2018 09:12:35</td>
                                    <td>Michael K. Ledford </td>
                                </tr>
                                <tr>
                                    <td colspan="8"><a href="#" class="btn btn-outline-light float-right">View Details</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- end top selling products  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- revenue locations  -->
        <!-- ============================================================== -->
        <div class="col-xl-5 col-lg-12 col-md-12 col-sm-12 col-12">
            <div class="card">
                <h5 class="card-header">Revenue by Location</h5>
                <div class="card-body">
                    <div id="locationmap" style="width:100%; height:200px"></div>
                </div>
                <div class="card-body border-top">
                    <div class="row">
                        <div class="col-xl-6">
                            <div class="sell-ratio">
                                <h5 class="mb-1 mt-0 font-weight-normal">New York</h5>
                                <div class="progress-w-percent">
                                    <span class="progress-value">72k </span>
                                    <div class="progress progress-sm">
                                        <div class="progress-bar" role="progressbar" style="width: 72%;" aria-valuenow="72" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-6">
                            <div class="sell-ratio">
                                <h5 class="mb-1 mt-0 font-weight-normal">San Francisco</h5>
                                <div class="progress-w-percent">
                                    <span class="progress-value">39k</span>
                                    <div class="progress progress-sm">
                                        <div class="progress-bar" role="progressbar" style="width: 39%;" aria-valuenow="39" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-6">
                            <div class="sell-ratio">
                                <h5 class="mb-1 mt-0 font-weight-normal">Sydney</h5>
                                <div class="progress-w-percent">
                                    <span class="progress-value">25k </span>
                                    <div class="progress progress-sm">
                                        <div class="progress-bar" role="progressbar" style="width: 39%;" aria-valuenow="39" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-6">
                            <div class="sell-ratio">
                                <h5 class="mb-1 mt-0 font-weight-normal">Singapore</h5>
                                <div class="progress-w-percent mb-0">
                                    <span class="progress-value">61k </span>
                                    <div class="progress progress-sm">
                                        <div class="progress-bar" role="progressbar" style="width: 61%;" aria-valuenow="61" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- end revenue locations  -->
        <!-- ============================================================== -->
    </div>
</div>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>

    $(document).ready(function () {
        $('#menuDashboard').addClass("active");
        loadRealTimeData();

        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(drawPieChart);

        google.charts.load('current', { packages: ['corechart', 'line'] });
        google.charts.setOnLoadCallback(drawLineChart);
    });

    //AJAX Call to retrieve data from backend
    function loadRealTimeData() {
        $.ajax({
            type: "GET",
            url: "/api/dashboard/retrieveRealTimeData",
            dataType: "json",
            success: function (data) {
                console.log(data);
                $('#NumberOfOrder').text(data.todayOrderNumber);
                $('#numberOfRevenue').text(`$${data.todayRevenueNumber.toFixed(2)}`);
                $('#numberOfPhotos').text(data.todayPhotoNumber);

                var orderRate = data.rateOrder;
                var revenueRate = data.rateRevenue;
                var photoRate = data.ratePhoto;

                $('#RateOfOrder').text(orderRate + "%");
                if (orderRate < 0) {
                    $('#IconOfOrder').removeClass('fa-caret-up');
                    $('#IconOfOrder').addClass('fa-caret-down');
                    $('#ColorOfOrder').removeClass('text-success');
                    $('#ColorOfOrder').addClass('text-danger');
                }
                else {
                    $('#IconOfOrder').addClass('fa-caret-up');
                    $('#IconOfOrder').removeClass('fa-caret-down');
                    $('#ColorOfOrder').addClass('text-success');
                    $('#ColorOfOrder').removeClass('text-danger');
                }

                $('#RateOfRevenue').text(revenueRate + "%");
                if (revenueRate < 0) {
                    $('#IconOfRevenue').removeClass('fa-caret-up');
                    $('#IconOfRevenue').addClass('fa-caret-down');
                    $('#ColorOfRevenue').removeClass('text-success');
                    $('#ColorOfRevenue').addClass('text-danger');
                }
                else {
                    $('#IconOfRevenue').addClass('fa-caret-up');
                    $('#IconOfRevenue').removeClass('fa-caret-down');
                    $('#ColorOfRevenue').addClass('text-success');
                    $('#ColorOfRevenue').removeClass('text-danger');
                }

                $('#rateOfPhotos').text(photoRate + "%");
                if (photoRate < 0) {
                    $('#IconOfPhotos').removeClass('fa-caret-up');
                    $('#IconOfPhotos').addClass('fa-caret-down');
                    $('#ColorOfPhotos').removeClass('text-success');
                    $('#ColorOfPhotos').addClass('text-danger');
                }
                else {
                    $('#IconOfPhotos').addClass('fa-caret-up');
                    $('#IconOfPhotos').removeClass('fa-caret-down');
                    $('#ColorOfPhotos').addClass('text-success');
                    $('#ColorOfPhotos').removeClass('text-danger');
                }
            },
            error: function (data) {
                console.log("Error");
                console.log(data);
            }
        });
    }
</script>

<script type="text/javascript">

    function drawPieChart() {
        $.ajax({
            type: "GET",
            url: "/api/dashboard/retrivePieChartData",
            dataType: "json",
            success: function (data) {
                loadPieChart(data);
            },
            error: function (data) {
                console.log("Error");
                console.log(data);
            }
        });
    }

    function loadPieChart(pieData) {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Sales Product');
        data.addColumn('number', 'Product Revenue');
        var dataRows = [];

        var listOfColors = ['#EF9191', '#9791EF', '#ECEF91', '#91EF98', '#91ADEF', '#839573', '#41C6BF'];
        var pieColors = [];
        for (i = 0; i < pieData.length; i++) {
            dataRows.push([pieData[i].product_name, { v: pieData[i].amount, f: `$${pieData[i].amount.toFixed(2)}` }]);
            var $proLegend = $(`<p><span class="fa-xs mr-1 legend-title" style="color: ${listOfColors[i]}"><i class="fa fa-fw fa-square-full"></i></span><span class="legend-text">${pieData[i].product_name}</span><span class="float-right">$${pieData[i].amount.toFixed(2)}</span></p>`)
            $('#productLegend').append($proLegend);
            pieColors.push(listOfColors[i]);
        }
        data.addRows(dataRows);
        console.log(data);

        var options = {
            pieSliceText: 'none',
            pieHole: 0.5,
            legend: 'none',
            chartArea: {
                left: "3%",
                top: "3%",
                height: "94%",
                width: "94%"
            },
            colors: pieColors
        };

        var chart = new google.visualization.PieChart(document.getElementById('donutchartForProductSales'));
        chart.draw(data, options);
    }
    function drawLineChart() {
        $.ajax({
            type: "GET",
            url: "/api/dashboard/retriveLineChartData",
            dataType: "json",
            success: function (data) {
                console.log(data);
                loadLineChart(data);
            },
            error: function (data) {
                console.log("Error");
                console.log(data);
            }
        });
        
    }
    function loadLineChart(chartData) {

        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Time Span');
        data.addColumn('number', 'Number Of Orders');
        data.addColumn('number', 'Number Of Orders');
        var dataRows = [];
        
        for (i = 0; i < chartData.length; i++) {
            dataRows.push([chartData[i].TimeSpan, chartData[i].numberOfOrders, chartData[i].numberOfOrders]);
        }
        data.addRows(dataRows);

        var options = {
            vAxis: { title: 'Number of Orders Completed' },
            hAxis: { title: 'Time' },
            seriesType: 'bars',
            legend: 'none',
            series: { 1 : { type: 'line' } }
        };

        var chart = new google.visualization.ComboChart(document.getElementById('lineChart'));
        chart.draw(data, options);
        
    }
</script>