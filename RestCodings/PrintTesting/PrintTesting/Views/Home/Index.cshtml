<div id="msgInProgress">
    <div id="mySpinner" style="width:32px;height:32px"></div>
    <br />
    <h3>Detecting WCPP utility at client side...</h3>
    <h3>Please wait a few seconds...</h3>
    <br />
</div>
<div id="msgInstallWCPP" style="display:none;">
    <h3>#1 Install WebClientPrint Processor (WCPP)!</h3>
    <p>
        <strong>WCPP is a native app (without any dependencies!)</strong> that handles all print jobs
        generated by the <strong>WebClientPrint for ASP.NET component</strong> at the server side. The WCPP
        is in charge of the whole printing process and can be
        installed on <strong>Windows, Linux, Mac & Raspberry Pi!</strong>
    </p>
    <p>
        <a href="//www.neodynamic.com/downloads/wcpp/" target="_blank">Download and Install WCPP from Neodynamic website</a><br />
    </p>
    <h3>#2 After installing WCPP...</h3>
    <p>
        <a asp-controller="PrintPDF" asp-action="Index">You can go and test the printing page...</a>
    </p>

</div>
<div class="row">
    <div class="col-md-4 col-md-offset-2">
        <hr />
        <div class="checkbox">
            <label>
                <input type="checkbox" id="useDefaultPrinter" />
                <strong>Print to Default printer</strong> or...
            </label>
        </div>
        <div id="loadPrinters">
            Click to load and select one of the installed printers!
            <br />
            <a onclick="javascript:jsWebClientPrint.getPrinters();" class="btn btn-success">Load installed printers...</a>
            <br />
            <br />
        </div>
        <div id="installedPrinters" style="visibility: hidden">
            <label for="installedPrinterName">Select an installed Printer:</label>
            <select name="installedPrinterName" id="installedPrinterName" class="form-control"></select>
        </div>
        <script type="text/javascript">
                        //var wcppGetPrintersDelay_ms = 0;
                        var wcppGetPrintersTimeout_ms = 60000; //60 sec
                        var wcppGetPrintersTimeoutStep_ms = 500; //0.5 sec
                        function wcpGetPrintersOnSuccess() {
                            // Display client installed printers
                            if (arguments[0].length > 0) {
                                var p = arguments[0].split("|");
                                var options = '';
                                for (var i = 0; i < p.length; i++) {
                                    options += '<option>' + p[i] + '</option>';
                                }
                                $('#installedPrinters').css('visibility', 'visible');
                                $('#installedPrinterName').html(options);
                                $('#installedPrinterName').focus();
                                $('#loadPrinters').hide();
                            } else {
                                alert("No printers are installed in your system.");
                            }
                        }
                        function wcpGetPrintersOnFailure() {
                            // Do something if printers cannot be got from the client
                            alert("No printers are installed in your system.");
                        }
        </script>
    </div>
</div>
<input type="file" id="newfile" />
<button type="button" onclick="uploadFile()">Upload</button>
<script>
        function uploadFile() {
            let printername = $('#installedPrinterName').val();
            console.log(printername);
            var formData = new FormData();
            var file = $('#newfile')[0];
            formData.append('file', file.files[0]);
            $.ajax({
                url: `/api/printing?printername=${printername}`,
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function (d) {
                    console.log("success");
                }
            });
        }
</script>
@section scripts{
    <script>
            var wcppPingTimeout_ms = 60000; //60 sec
            var wcppPingTimeoutStep_ms = 500; //0.5 sec

            function wcppDetectOnSuccess(){
            // WCPP utility is installed at the client side
            // redirect to WebClientPrint sample page

            // get WCPP version
            var wcppVer = arguments[0];
                if (wcppVer.substring(0, 1) == "5") {
                    console.log("Hi");
                }
                else { //force to install WCPP v5.0
                    wcppDetectOnFailure();
                }
            }

            function wcppDetectOnFailure() {
            // It seems WCPP is not installed at the client side
            // ask the user to install it
            $('#msgInProgress').hide();
            $('#msgInstallWCPP').show();
            }
    </script>
    @Html.Raw(ViewBag.WCPScript);


}
